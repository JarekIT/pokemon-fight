let btnAtkSimple,btnAtkSpec,btnGenPlayer,btnGenOpponent,btnHealPlayer,btnHealOpponent,btnLevelup,btnClearLog,btnChoosePokemon,btnHideUp,btnHideDown,divHideUp,divHideDown,imgPlayer,imgOpponent,descrPlayer,descrOpponent,gameLogs,progressHpPlayer,progressHpOpponent,logId=0;const apiLink="https://pokeapi.co/api/v2/pokemon/";let $pokemonPlayer,$pokemonOpponent,number,name,level,img,hp,attack,defense,attackSp,defenseSp,speed,stats={hp:0,attack:0,defense:0,attackSp:0,defenseSp:0,speed:0},attackerAlive=!0,defenderAlive=!0;const main=()=>{prepareDOMElements(),prepareDOMEvents()},prepareDOMElements=()=>{btnAtkSimple=document.querySelector(".btn-atk-simple"),btnAtkSpecial=document.querySelector(".btn-atk-special"),btnGenPlayer=document.querySelector(".btn-generate-player"),btnGenOpponent=document.querySelector(".btn-generate-opponent"),btnHealPlayer=document.querySelector(".btn-heal-player"),btnHealOpponent=document.querySelector(".btn-heal-opponent"),btnLevelup=document.querySelector(".btn-levelup"),btnClearLog=document.querySelector(".btn-clear-log"),btnHideUp=document.querySelector(".btn-hide-up"),btnHideDown=document.querySelector(".btn-hide-down"),divHideUp=document.querySelector(".hide-up"),divHideDown=document.querySelector(".hide-down"),imgList=document.querySelector(".img-list"),imgPlayer=document.querySelector(".img-player"),imgOpponent=document.querySelector(".img-opponent"),descrOpponent=document.querySelector(".descr-opponent"),descrPlayer=document.querySelector(".descr-player"),progressHpPlayer=document.querySelector(".progress-player"),progressHpOpponent=document.querySelector(".progress-opponent"),gameLogs=document.querySelector(".game-logs")};class Pokemon{constructor(a,b,c,d,e,f,g,h,i){this.number=a,this.name=b,this.level=1,this.img=c,this.stats={hp:2*d,attack:e,defense:f,attackSp:g,defenseSp:h,speed:i,hpLeft:2*d}}levelUp(){typeof("undefined"!=stats)&&(this.level++,this.stats.hp=Math.floor(1.1*this.stats.hp),this.stats.attack=Math.floor(1.1*this.stats.attack),this.stats.defense=Math.floor(1.1*this.stats.defense),this.stats.attackSp=Math.floor(1.1*this.stats.attackSp),this.stats.defenseSp=Math.floor(1.1*this.stats.defenseSp),this.stats.speed=Math.floor(1.1*this.stats.speed),this.stats.hpLeft=Math.floor(1.1*this.stats.hpLeft),updateDescription(this),updateBattleLogs(`${this.name} has just leveled up! Gained +10% in all stats<br>`))}heal(){let a=this.stats.hpLeft+50;a=a>this.stats.hp?this.stats.hp:a,updateBattleLogs(`Trainer heals pokemon from: ${this.stats.hpLeft} to ${a}hp<br>`),this.stats.hpLeft=a,updateHpBar(this),updateDescription(this)}}$pokemonPlayer=new Pokemon(0,"Generate Player before fight","",100,10,100,100,100,100),$pokemonOpponent=new Pokemon(0,"Generate Opponent before fight","",100,10,100,100,100,100);const getAllPokemons=()=>{for(let a,b=1;152>b;b++){a=document.createElement("img"),a.setAttribute("src",`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${b}.png`),a.setAttribute("id",b),a.setAttribute("width","50px");let c=document.createElement("div");c.className="col-sm-1",c.appendChild(a),imgList.appendChild(c)}},setButtonsOnImages=()=>{for(let a=1;152>a;a++)btnChoosePokemon=document.getElementById(a),btnChoosePokemon.addEventListener("click",()=>{console.log("Player chooses Pokemon number: "+a),generatePlayer(a)})},getOnePokemon=a=>new Promise((b,c)=>{axios.get(apiLink+a).then(c=>{for(let a in number=c.data.id,name=c.data.name,stats=Object.assign({},c.data.stats),stats)0==a?hp=stats[a].base_stat:1==a?attack=stats[a].base_stat:2==a?defense=stats[a].base_stat:3==a?attackSp=stats[a].base_stat:4==a?defenseSp=stats[a].base_stat:5==a&&(speed=stats[a].base_stat);img=`https://pokeres.bastionbot.org/images/pokemon/${a}.png`;const d=new Pokemon(number,name,img,hp,attack,defense,attackSp,defenseSp,speed);b(d)}).catch(a=>{console.log(a),c(a)})});async function generatePlayer(a){(0==a||a==null||null==a)&&(a=Math.floor(151*Math.random())+1);try{$pokemonPlayer=await getOnePokemon(a),console.log($pokemonPlayer),imgPlayer.setAttribute("width","150px"),imgPlayer.setAttribute("src",img),updateDescription($pokemonPlayer),updateHpBar($pokemonPlayer),setAliveAllPokemons(),divHideUp.classList.contains("hide-up")||switchShowHideUpContainer(),divHideDown.classList.contains("hide-down")&&switchShowHideDownContainer()}catch(a){console.log(a)}}async function generateOpponent(a){(0==a||a==null||null==a)&&(a=Math.floor(152*Math.random()));try{$pokemonOpponent=await getOnePokemon(a),console.log($pokemonOpponent),imgOpponent.setAttribute("width","150px"),imgOpponent.setAttribute("src",img),updateDescription($pokemonOpponent),updateHpBar($pokemonOpponent),setAliveAllPokemons()}catch(a){console.log(a)}}const atack=a=>{let b,c,d,e,f;const g=()=>{$pokemonPlayer.stats.speed>=$pokemonOpponent.stats.speed?(b=$pokemonPlayer,c=$pokemonOpponent):(b=$pokemonOpponent,c=$pokemonPlayer),updateBattleLogs(`${b.name} is faster - it will attack first<br>`)},h=a=>{"special"==a?(attack=b.stats.attackSp,defense=c.stats.defenseSp):"simple"==a&&(attack=b.stats.attack,defense=c.stats.defense),d=Math.floor(Math.random()*attack/2),e=Math.floor(Math.random()*defense/2),f=0<=d-e?d-e:0,updateBattleLogs(`${b.name} use ${a} attack and deals ${f} damages (${d} attacks vs ${e} defends)<br>`)},i=a=>{const d=c.stats.hpLeft-a;0<d?(c.stats.hpLeft=d,updateBattleLogs(`${c.name} has ${c.stats.hpLeft} hp<br>`)):(c.stats.hpLeft=0,updateBattleLogs(`${c.name} has ${c.stats.hpLeft} hp<br>`),defenderAlive=!1,updateDescription(c),updateHpBar(c),updateBattleLogs(`<u>The winner is: ${b.name}</u><br>`),c==$pokemonOpponent?$pokemonPlayer.levelUp():$pokemonOpponent.levelUp())},j=()=>{b==$pokemonPlayer?(b=$pokemonOpponent,c=$pokemonPlayer):(b=$pokemonPlayer,c=$pokemonOpponent)};attackerAlive&&defenderAlive?(updateBattleLogs(`- - - - - New round - - - - -<br>`),g(),shakeScreenAfterAttack(),h(a),i(f),updateDescription(c),updateHpBar(c),defenderAlive&&(j(),h(a),i(f),updateDescription(c),updateHpBar(c),updateBattleLogs(`- - - - - End of round - - - - -<br>`))):updateBattleLogs(`<u>Fight is over, choose new Pokemon</u><br><br>`),0==$pokemonOpponent.stats.hpLeft&&setTimeout(askForAnotherFight,750)},shakeScreenAfterAttack=()=>{const a=2;(()=>{for(let b=0;b<400;b++)window.moveBy(a,0),window.moveBy(0,a),window.moveBy(-a,0),window.moveBy(0,-a)})()},askForAnotherFight=()=>{confirm(`The fight is over, do you want to fight with another Pokemon?`)&&generateOpponent(0)},updateDescription=a=>{const b=`<h5>Name: ${a.name}</h5> 
        <table class="table table-sm table-bordered w-auto">
            <tr>
                <th>Level</th>
                <th>Attack</th>
                <th>Defense</th>
                <th>Attack<br>Special</th>
                <th>Defense<br>Special</th>
                <th>Hp<br>left</th>
                <th>Hp<br>max</th>
                <th>Speed</th>
            </tr>
            <tr>
                <td>${a.level}</td>
                <td>${a.stats.attack}</td>
                <td>${a.stats.defense}</td>
                <td>${a.stats.attackSp}</td>
                <td>${a.stats.defenseSp}</td>
                <td>${a.stats.hpLeft}</td>
                <td>${a.stats.hp}</td>
                <td>${a.stats.speed}</td>
            </tr>
        </table>`;a==$pokemonPlayer?descrPlayer.innerHTML=b:descrOpponent.innerHTML=b},updateHpBar=a=>{let b=Math.floor(100*(a.stats.hpLeft/a.stats.hp));a==$pokemonPlayer?progressHpPlayer.style.width=`${b}%`:progressHpOpponent.style.width=`${b}%`},setAliveAllPokemons=()=>{attackerAlive=!0,defenderAlive=!0},updateBattleLogs=a=>gameLogs.innerHTML=` (${logId++}) - ${a+gameLogs.innerHTML}`,clearBattleLogs=()=>gameLogs.innerText="",switchShowHideUpContainer=()=>divHideUp.classList.toggle("hide-up"),switchShowHideDownContainer=()=>divHideDown.classList.toggle("hide-down"),prepareDOMEvents=()=>{btnAtkSimple.addEventListener("click",()=>attack("simple")),btnAtkSpecial.addEventListener("click",()=>attack("special")),btnGenPlayer.addEventListener("click",()=>generatePlayer(0)),btnGenOpponent.addEventListener("click",()=>generateOpponent(0)),btnHealPlayer.addEventListener("click",()=>$pokemonPlayer.heal()),btnHealOpponent.addEventListener("click",()=>$pokemonOpponent.heal()),btnLevelup.addEventListener("click",()=>$pokemonPlayer.levelUp()),btnClearLog.addEventListener("click",clearBattleLogs),btnHideUp.addEventListener("click",switchShowHideUpContainer),btnHideDown.addEventListener("click",switchShowHideDownContainer),generateOpponent(),getAllPokemons(),setButtonsOnImages(),switchShowHideUpContainer()};document.addEventListener("DOMContentLoaded",main);